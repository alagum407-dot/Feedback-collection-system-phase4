<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Feedback Collection System</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --muted:#94a3b8;
    --accent1:#7c3aed;
    --accent2:#06b6d4;
    --glass: rgba(255,255,255,0.03);
    --radius:14px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 600px at 10% 10%, rgba(124,58,237,0.08), transparent),
                radial-gradient(1000px 500px at 90% 90%, rgba(6,182,212,0.06), transparent),
                var(--bg);
    color:#e6eef8;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:28px;
    display:flex;
    gap:24px;
    align-items:flex-start;
    justify-content:center;
  }

  .container{
    width:1100px;
    max-width:calc(100% - 48px);
    display:grid;
    grid-template-columns: 420px 1fr;
    gap:20px;
    align-items:start;
  }

  /* left panel: form */
  .panel{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    border-radius:var(--radius);
    padding:18px;
    box-shadow: 0 6px 30px rgba(2,6,23,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
    backdrop-filter: blur(6px);
  }

  .brand{
    display:flex;align-items:center;gap:12px;margin-bottom:8px;
  }
  .logo{
    width:46px;height:46px;border-radius:10px;
    background:linear-gradient(135deg,var(--accent1),var(--accent2));
    display:flex;align-items:center;justify-content:center;font-weight:700;
    box-shadow: 0 6px 18px rgba(12,18,40,0.6);
  }
  .brand h1{font-size:16px;margin:0}
  .brand p{margin:0;color:var(--muted);font-size:12px}

  form .row{display:flex;gap:10px}
  label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
  input[type="text"], input[type="email"], textarea, select{
    width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);
    background:transparent;color:inherit;font-size:14px;outline:none;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.02);
  }
  textarea{min-height:120px;resize:vertical}
  .small{font-size:12px;color:var(--muted)}
  .btn{
    display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;
    background:linear-gradient(90deg,var(--accent1),var(--accent2));border:none;color:white;
    cursor:pointer;font-weight:600;box-shadow: 0 8px 18px rgba(8,10,40,0.6);
  }
  .btn.secondary{
    background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);font-weight:600;
  }
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:12px}

  /* rating stars */
  .stars{display:inline-flex;gap:6px}
  .star{width:28px;height:28px;cursor:pointer;border-radius:6px;display:grid;place-items:center;background:rgba(255,255,255,0.02)}
  .star svg{width:18px;height:18px;opacity:0.9}
  .star.active{background:linear-gradient(90deg,#ffb86b,#ff6b6b);filter:drop-shadow(0 4px 12px rgba(255,107,107,0.15))}

  /* right area: list + dashboard */
  .right{
    display:flex;flex-direction:column;gap:16px;
  }
  .toolbar{
    display:flex;gap:12px;align-items:center;justify-content:space-between;
  }
  .search{
    display:flex;gap:10px;align-items:center;background:var(--glass);padding:8px;border-radius:10px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .search input{border:none;background:transparent;outline:none;color:inherit}

  .stats{
    display:grid;grid-template-columns:repeat(3,1fr);gap:12px;
  }
  .stat{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:12px;border-radius:12px;display:flex;flex-direction:column;gap:6px;
  }
  .stat h3{margin:0;font-size:14px}
  .stat p{margin:0;font-size:20px;font-weight:700}

  .list{
    display:grid;gap:10px;
    margin-top:8px;
  }
  .card{
    display:flex;gap:12px;padding:12px;border-radius:12px;align-items:flex-start;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
    border:1px solid rgba(255,255,255,0.02);
  }
  .avatar{
    width:48px;height:48px;border-radius:10px;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));font-weight:700;
  }
  .meta{flex:1}
  .meta h4{margin:0;font-size:15px}
  .meta .muted{font-size:12px;color:var(--muted);margin-top:6px}
  .meta .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
  .tag{padding:6px 8px;border-radius:999px;font-size:12px;background:rgba(255,255,255,0.03);color:var(--muted)}

  .card .actions{display:flex;flex-direction:column;gap:8px}
  .tiny{font-size:12px;padding:6px 8px;border-radius:8px}

  /* tag cloud */
  .tag-cloud{display:flex;gap:8px;flex-wrap:wrap}
  .tag-cloud .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02);cursor:pointer}

  /* footer small */
  .muted-small{font-size:12px;color:var(--muted)}

  /* responsive */
  @media (max-width:1000px){
    .container{grid-template-columns:1fr; width:100%}
  }

  /* subtle animations */
  .fade-in{animation:fadeIn .45s both}
  @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

  /* dark mode toggle */
  .toggle{cursor:pointer;padding:8px;border-radius:10px;background:rgba(255,255,255,0.02)}
</style>
</head>
<body>
  <div class="container fade-in" role="application" aria-label="Feedback Collection System">
    <!-- LEFT: Input form -->
    <section class="panel" aria-labelledby="form-title">
      <div class="brand">
        <div class="logo">FB</div>
        <div>
          <h1 id="form-title">Feedback Collection System</h1>
          <p>Collect user feedback, analyze and export — all client-side.</p>
        </div>
      </div>

      <form id="feedbackForm" autocomplete="off" novalidate>
        <div style="display:flex;gap:10px">
          <div style="flex:1">
            <label for="name">Name</label>
            <input id="name" type="text" placeholder="Your name" required />
          </div>
          <div style="width:160px">
            <label for="category">Category</label>
            <select id="category">
              <option value="general">General</option>
              <option value="bug">Bug</option>
              <option value="feature">Feature Request</option>
              <option value="ux">UX</option>
            </select>
          </div>
        </div>

        <div style="margin-top:10px">
          <label for="email">Email <span class="small"> (optional)</span></label>
          <input id="email" type="email" placeholder="you@example.com" />
        </div>

        <div style="margin-top:10px">
          <label for="message">Feedback</label>
          <textarea id="message" placeholder="Describe your feedback..." required></textarea>
        </div>

        <div style="margin-top:10px;display:flex;align-items:center;justify-content:space-between">
          <div>
            <label>Rating</label>
            <div class="stars" id="ratingStars" role="radiogroup" aria-label="Rating (1-5)">
              <!-- stars injected by JS -->
            </div>
          </div>
          <div style="width:220px">
            <label for="tags">Tags (comma separated)</label>
            <input id="tags" type="text" placeholder="ui, onboarding, performance" />
          </div>
        </div>

        <div class="controls">
          <button class="btn" type="submit" id="submitBtn">Send feedback</button>
          <button class="btn secondary" id="resetBtn" type="button">Reset form</button>
          <button class="btn secondary" id="importBtn" type="button">Import JSON</button>
          <input id="importFile" type="file" accept=".json" style="display:none" />
        </div>

        <div style="margin-top:12px;display:flex;gap:8px;align-items:center;justify-content:space-between">
          <div class="small muted-small">Saved locally in your browser. Export to share.</div>
          <div style="display:flex;gap:8px">
            <button class="btn secondary" id="exportCsv" type="button">Export CSV</button>
            <button class="btn secondary" id="exportJson" type="button">Export JSON</button>
          </div>
        </div>
      </form>
    </section>

    <!-- RIGHT: Dashboard + list -->
    <section class="right">
      <div class="panel">
        <div class="toolbar">
          <div style="display:flex;gap:12px;align-items:center">
            <div class="search" role="search" aria-label="Search feedback">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6"></circle></svg>
              <input id="searchInput" type="text" placeholder="Search by name, message or tag" />
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <label class="small" for="filterCategory">Filter</label>
              <select id="filterCategory" aria-controls="list">
                <option value="all">All categories</option>
                <option value="general">General</option>
                <option value="bug">Bug</option>
                <option value="feature">Feature Request</option>
                <option value="ux">UX</option>
              </select>
            </div>

            <div style="display:flex;gap:8px;align-items:center">
              <label class="small" for="sortSelect">Sort</label>
              <select id="sortSelect">
                <option value="newest">Newest</option>
                <option value="oldest">Oldest</option>
                <option value="highest">Highest rating</option>
                <option value="lowest">Lowest rating</option>
              </select>
            </div>
          </div>

          <div style="display:flex;gap:8px;align-items:center">
            <div class="muted-small" id="totalCount">0 feedback</div>
            <div class="toggle" id="darkToggle" title="Toggle dark/light (client-side only)">🌗</div>
          </div>
        </div>

        <div style="margin-top:12px" class="stats" aria-hidden="false">
          <div class="stat">
            <h3>Average rating</h3>
            <p id="avgRating">—</p>
            <div class="small muted-small">Quick view of user sentiment</div>
          </div>
          <div class="stat">
            <h3>Total feedback</h3>
            <p id="feedbackCount">0</p>
            <div class="small muted-small">Entries stored locally</div>
          </div>
          <div class="stat">
            <h3>Top category</h3>
            <p id="topCategory">—</p>
            <div class="small muted-small">Most common feedback category</div>
          </div>
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
          <div style="flex:1">
            <canvas id="categoryChart" height="80"></canvas>
          </div>
          <div style="width:220px">
            <h4 style="margin:0 0 6px 0">Tag cloud</h4>
            <div class="tag-cloud" id="tagCloud" aria-live="polite"></div>
          </div>
        </div>
      </div>

      <div class="panel" id="listPanel" aria-live="polite">
        <h3 style="margin-top:0">Feedback list</h3>
        <div class="list" id="feedbackList" tabindex="0" role="list"></div>
        <div style="display:flex;justify-content:space-between;margin-top:12px;align-items:center">
          <div class="muted-small">Showing <span id="showingCount">0</span> of <span id="totalLocal">0</span></div>
          <div>
            <button class="btn secondary tiny" id="clearAll">Clear all</button>
          </div>
        </div>
      </div>
    </section>
  </div>

<script>
/* ---------- Utility helpers ---------- */
const uid = () => 'fb_' + Math.random().toString(36).slice(2,9);
const qs = sel => document.querySelector(sel);
const qsa = sel => Array.from(document.querySelectorAll(sel));
const fmtDate = ts => new Date(ts).toLocaleString();

/* ---------- App state & storage ---------- */
const STORAGE_KEY = 'feedback_collection_v1';
let feedbacks = []; // loaded from localStorage
let editingId = null;
let rating = 5;

/* ---------- DOM refs ---------- */
const form = qs('#feedbackForm');
const nameI = qs('#name');
const emailI = qs('#email');
const msgI = qs('#message');
const tagsI = qs('#tags');
const categoryI = qs('#category');
const starsWrap = qs('#ratingStars');
const submitBtn = qs('#submitBtn');
const resetBtn = qs('#resetBtn');
const exportCsvBtn = qs('#exportCsv');
const exportJsonBtn = qs('#exportJson');
const importBtn = qs('#importBtn');
const importFile = qs('#importFile');
const searchInput = qs('#searchInput');
const filterCategory = qs('#filterCategory');
const sortSelect = qs('#sortSelect');
const feedbackList = qs('#feedbackList');
const totalCount = qs('#totalCount');
const feedbackCount = qs('#feedbackCount');
const avgRating = qs('#avgRating');
const topCategory = qs('#topCategory');
const tagCloud = qs('#tagCloud');
const showingCount = qs('#showingCount');
const totalLocal = qs('#totalLocal');
const categoryChartCtx = qs('#categoryChart').getContext('2d');
const clearAllBtn = qs('#clearAll');
const darkToggle = qs('#darkToggle');

/* ---------- Render rating stars ---------- */
function renderStars(){
  starsWrap.innerHTML = '';
  for(let i=1;i<=5;i++){
    const s = document.createElement('button');
    s.className = 'star';
    s.type = 'button';
    s.setAttribute('aria-checked', i===rating ? 'true':'false');
    s.setAttribute('role','radio');
    s.title = i + ' star' + (i>1?'s':'');
    s.innerHTML = `<svg viewBox="0 0 24 24" fill="${i<=rating? 'currentColor':'none'}" stroke="currentColor" stroke-width="1.6"><path d="M12 .587l3.668 7.431L24 9.748l-6 5.847L19.335 24 12 19.897 4.665 24 6 15.595 0 9.748l8.332-1.73z"/></svg>`;
    if(i<=rating) s.classList.add('active');
    s.addEventListener('click', ()=>{ rating = i; renderStars(); });
    starsWrap.appendChild(s);
  }
}
renderStars();

/* ---------- Storage load/save ---------- */
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    feedbacks = raw ? JSON.parse(raw) : [];
  }catch(e){
    console.error('Failed to load storage', e);
    feedbacks = [];
  }
}
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(feedbacks));
}

/* ---------- CRUD: create/update ---------- */
function createFeedback({name,email,message,tags,category,rating}){
  const entry = {
    id: uid(),
    name: name || 'Anonymous',
    email: email || '',
    message,
    tags: tags.filter(t=>t).map(t=>t.trim().toLowerCase()),
    category,
    rating,
    createdAt: Date.now()
  };
  feedbacks.unshift(entry);
  save();
  renderAll();
  return entry;
}
function updateFeedback(id, data){
  const idx = feedbacks.findIndex(f=>f.id===id);
  if(idx>=0){
    feedbacks[idx] = {...feedbacks[idx], ...data};
    save();
    renderAll();
  }
}
function deleteFeedback(id){
  feedbacks = feedbacks.filter(f=>f.id!==id);
  save();
  renderAll();
}

/* ---------- Render list & stats ---------- */
let categoryChart = null;
function computeStats(list){
  const total = list.length;
  const avg = total ? (list.reduce((s,i)=>s+i.rating,0)/total) : 0;
  const byCategory = {};
  list.forEach(f=> byCategory[f.category] = (byCategory[f.category]||0)+1);
  const topCat = Object.keys(byCategory).sort((a,b)=>byCategory[b]-byCategory[a])[0] || '—';
  return {total, avg: Number(avg.toFixed(2)), topCat, byCategory};
}

function renderList(filtered){
  feedbackList.innerHTML = '';
  if(filtered.length===0){
    const p = document.createElement('div');
    p.className = 'muted-small';
    p.textContent = 'No feedback yet. Be the first!';
    feedbackList.appendChild(p);
    return;
  }

  filtered.forEach(f=>{
    const card = document.createElement('div');
    card.className = 'card fade-in';
    card.setAttribute('role','listitem');
    card.innerHTML = `
      <div class="avatar" aria-hidden="true">${(f.name||'A').slice(0,2).toUpperCase()}</div>
      <div class="meta">
        <h4>${escapeHtml(f.name)} <span class="muted" style="font-weight:600;font-size:12px">· ${f.rating}⭐</span></h4>
        <div class="muted">${escapeHtml(f.email || '')} ${f.email? '·':''} ${fmtDate(f.createdAt)}</div>
        <div class="muted" style="margin-top:8px">${escapeHtml(truncate(f.message, 260))}</div>
        <div class="tags">${f.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>
        <div style="margin-top:8px" class="small muted-small">Category: <strong>${escapeHtml(f.category)}</strong></div>
      </div>
      <div class="actions" aria-hidden="true">
        <button class="tiny" data-action="view" data-id="${f.id}">View</button>
        <button class="tiny" data-action="edit" data-id="${f.id}">Edit</button>
        <button class="tiny" data-action="delete" data-id="${f.id}">Delete</button>
      </div>
    `;
    feedbackList.appendChild(card);
  });
}

/* ---------- Helpers & UI glue ---------- */
function escapeHtml(s){ if(!s) return ''; return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function truncate(s, n){ return s.length>n ? s.slice(0,n-1)+'…' : s; }

function buildTagCloud(all){
  const counts = {};
  all.forEach(f=> f.tags.forEach(t=> counts[t] = (counts[t]||0)+1));
  const keys = Object.keys(counts).sort((a,b)=>counts[b]-counts[a]).slice(0,20);
  tagCloud.innerHTML = keys.length? keys.map(k=>`<div class="chip" data-tag="${k}">${k} (${counts[k]})</div>`).join('') : '<div class="muted-small">No tags yet</div>';
  // attach click handlers
  qsa('.tag-cloud .chip').forEach(el=> el.addEventListener('click', ()=> {
    searchInput.value = el.dataset.tag;
    applyFilters();
  }));
}

function renderStats(list){
  const {total, avg, topCat, byCategory} = computeStats(list);
  totalCount.textContent = total + ' feedback';
  feedbackCount.textContent = total;
  avgRating.textContent = total? avg : '—';
  topCategory.textContent = topCat || '—';
  totalLocal.textContent = feedbacks.length;
  showingCount.textContent = list.length;

  // render chart
  const labels = Object.keys(byCategory);
  const data = labels.map(l=>byCategory[l]);
  if(categoryChart) categoryChart.destroy();
  categoryChart = new Chart(categoryChartCtx, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{data, borderWidth:0, hoverOffset:8}]
    },
    options: {
      plugins:{legend:{position:'bottom', labels:{color:'#cbd5e1'}}}
    }
  });
}

/* ---------- Filter / search / sort pipeline ---------- */
function applyFilters(){
  const q = (searchInput.value || '').trim().toLowerCase();
  const filter = filterCategory.value;
  const sort = sortSelect.value;

  let list = feedbacks.slice();

  if(filter !== 'all') list = list.filter(f=>f.category === filter);
  if(q){
    list = list.filter(f=>{
      return (f.name||'').toLowerCase().includes(q) ||
             (f.message||'').toLowerCase().includes(q) ||
             (f.tags||[]).some(t=>t.includes(q));
    });
  }

  if(sort === 'newest') list.sort((a,b)=> b.createdAt - a.createdAt);
  if(sort === 'oldest') list.sort((a,b)=> a.createdAt - b.createdAt);
  if(sort === 'highest') list.sort((a,b)=> b.rating - a.rating);
  if(sort === 'lowest') list.sort((a,b)=> a.rating - b.rating);

  renderList(list);
  renderStats(list);
}

/* ---------- Form events ---------- */
form.addEventListener('submit', e=>{
  e.preventDefault();
  const name = nameI.value.trim();
  const email = emailI.value.trim();
  const message = msgI.value.trim();
  const tags = tagsI.value.split(',').map(t=>t.trim()).filter(t=>t);
  const category = categoryI.value;
  const r = rating;

  if(!message){
    alert('Please enter your feedback message.');
    msgI.focus();
    return;
  }

  if(editingId){
    updateFeedback(editingId, {name, email, message, tags, category, rating: r});
    editingId = null;
    submitBtn.textContent = 'Send feedback';
  } else {
    createFeedback({name,email,message,tags,category,rating:r});
  }

  form.reset();
  rating = 5;
  renderStars();
  nameI.focus();
});

resetBtn.addEventListener('click', ()=>{
  form.reset();
  rating = 5;
  renderStars();
  editingId = null;
  submitBtn.textContent = 'Send feedback';
});

/* click events for list (delegation) */
feedbackList.addEventListener('click', e=>{
  const btn = e.target.closest('button[data-action]');
  if(!btn) return;
  const id = btn.dataset.id;
  const action = btn.dataset.action;
  const fed = feedbacks.find(f=>f.id===id);
  if(!fed) return;

  if(action === 'view'){
    const txt = `From: ${fed.name} ${fed.email?(' <'+fed.email+'>'):''}\nRating: ${fed.rating}\nCategory: ${fed.category}\nTime: ${fmtDate(fed.createdAt)}\n\n${fed.message}\n\nTags: ${fed.tags.join(', ')}`;
    alert(txt);
  }
  if(action === 'edit'){
    editingId = id;
    nameI.value = fed.name;
    emailI.value = fed.email;
    msgI.value = fed.message;
    tagsI.value = fed.tags.join(', ');
    categoryI.value = fed.category;
    rating = fed.rating || 5;
    renderStars();
    submitBtn.textContent = 'Save changes';
    window.scrollTo({top:0,behavior:'smooth'});
  }
  if(action === 'delete'){
    if(confirm('Delete this feedback? This cannot be undone.')){
      deleteFeedback(id);
    }
  }
});

/* ---------- Export / import ---------- */
function toCSV(arr){
  const cols = ['id','name','email','category','rating','message','tags','createdAt'];
  const rows = arr.map(r => cols.map(c => {
    let v = r[c];
    if(Array.isArray(v)) v = v.join(';');
    if(typeof v === 'string') v = v.replace(/\n/g,' ').replace(/"/g,'""');
    return `"${(v===undefined||v===null)?'':v}"`;
  }).join(','));
  return [cols.join(','), ...rows].join('\n');
}

exportCsvBtn.addEventListener('click', ()=>{
  const csv = toCSV(feedbacks);
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'feedbacks.csv'; a.click();
  URL.revokeObjectURL(url);
});

exportJsonBtn.addEventListener('click', ()=>{
  const blob = new Blob([JSON.stringify(feedbacks, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'feedbacks.json'; a.click();
  URL.revokeObjectURL(url);
});

importBtn.addEventListener('click', ()=> importFile.click());
importFile.addEventListener('change', async (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  try{
    const txt = await f.text();
    const data = JSON.parse(txt);
    if(!Array.isArray(data)) throw new Error('Invalid JSON format.');
    // Merge imported, keep unique ids
    const existingIds = new Set(feedbacks.map(x=>x.id));
    const imported = data.map(x => {
      if(!x.id) x.id = uid();
      return x;
    }).filter(x=>!existingIds.has(x.id));
    feedbacks = imported.concat(feedbacks);
    save();
    renderAll();
    alert(`Imported ${imported.length} entries.`);
  }catch(err){
    alert('Failed to import: ' + (err.message||err));
  } finally {
    importFile.value = '';
  }
});

/* ---------- search / filters ---------- */
[searchInput, filterCategory, sortSelect].forEach(el=>{
  el.addEventListener('input', debounce(applyFilters, 220));
});

/* ---------- clear all ---------- */
clearAllBtn.addEventListener('click', ()=>{
  if(!confirm('Erase all feedback stored locally?')) return;
  feedbacks = [];
  save();
  renderAll();
});

/* ---------- tag cloud click is handled in buildTagCloud ---------- */

/* ---------- Dark mode (client-only, visual) ---------- */
darkToggle.addEventListener('click', ()=>{
  const isDark = document.documentElement.style.getPropertyValue('--bg') === '#0f1724';
  if(isDark){
    // quick switch to light-ish
    document.documentElement.style.setProperty('--bg','#f7fafc');
    document.documentElement.style.setProperty('--card','#ffffff');
    document.documentElement.style.setProperty('--muted','#475569');
    document.documentElement.style.setProperty('--glass','rgba(2,6,23,0.03)');
    document.documentElement.style.setProperty('--accent1','#7c3aed');
    document.documentElement.style.setProperty('--accent2','#06b6d4');
    document.body.style.color = '#0b1220';
  }else{
    document.documentElement.style.setProperty('--bg','#0f1724');
    document.documentElement.style.setProperty('--card','#0b1220');
    document.documentElement.style.setProperty('--muted','#94a3b8');
    document.documentElement.style.setProperty('--glass','rgba(255,255,255,0.03)');
    document.body.style.color = '#e6eef8';
  }
});

/* ---------- Initialization ---------- */
function renderAll(){
  applyFilters();
  buildTagCloud(feedbacks);
}

/* ---------- small helpers ---------- */
function debounce(fn, t=200){
  let timer;
  return function(...args){ clearTimeout(timer); timer = setTimeout(()=>fn.apply(this,args), t); };
}

/* ---------- initial load ---------- */
load();
renderAll();

/* ---------- safe demo data for first-time users (only when empty) ---------- */
if(feedbacks.length===0){
  const demo = [
    { id: uid(), name:'Riya', email:'riya@example.com', message:'Loving the new UI — smooth and fast!', tags:['ui','performance'], category:'general', rating:5, createdAt: Date.now()-1000*60*60*24 },
    { id: uid(), name:'Sahil', email:'', message:'Found a small bug on login when using edge.', tags:['bug','login'], category:'bug', rating:3, createdAt: Date.now()-1000*60*60*2 },
    { id: uid(), name:'Maya', email:'maya@example.com', message:'Could we have dark mode toggles per user?', tags:['feature','ux'], category:'feature', rating:4, createdAt: Date.now()-1000*60*60*3 }
  ];
  feedbacks = demo;
  save();
  renderAll();
}

/* ---------- escape hatch: keyboard shortcuts ---------- */
document.addEventListener('keydown', (e)=>{
  if(e.ctrlKey && e.key.toLowerCase()==='k'){ e.preventDefault(); searchInput.focus(); }
  if(e.ctrlKey && e.key.toLowerCase()==='n'){ e.preventDefault(); nameI.focus(); }
});

/* ---------- end of script ---------- */
</script>
</body>
</html>
